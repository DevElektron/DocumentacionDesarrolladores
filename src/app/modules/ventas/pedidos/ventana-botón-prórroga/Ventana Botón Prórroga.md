# üì¶ M√≥dulo: Ventana Bot√≥n Pr√≥rroga
#### üìÅ **C√≥digo:** `src/app/modules/ventas/pedidos/components/prorroga`
#### üíª **Men√∫:** Men√∫ > > >  [Ver en QA](http://192.168.2.16:1089/app/ventas/pedidos)
#### üíª **Men√∫:** Men√∫ > > >  [Ver en QA](http://192.168.2.16:1089/app/ventas/pedidos)

## üìù Descripci√≥n

Cuando en la ruta de `/app/ventas/pedidos` se carga los pedidos al usuario el cual tiene el rol asignado de `Gerente`, se visualizar√° el bot√≥n `Aumentar d√≠as para Desasignaci√≥n del Pedido` (Pr√≥rroga del pedido). Cual el usuario selecciona dando clic a un pedido, se realiza una series de validaciones para verificar si el pedido y la configuraci√≥n del usuario es correcta para usar la funcionalidad de pr√≥rroga:

    1. El usuario/gerente que no sea Regional ni de Zona no podr√° asignar m√°s de 3 veces los d√≠as d√≠as adicionales del pedido seleccionado. Si es gerente de los 2 tipos mencionados, no tendr√° l√≠mites de asignaci√≥n, el sistema le preguntar√° al usuario si desea continuar con el proceso de pr√≥rroga, en caso de su confirmaci√≥n (ACEPTAR), entonces se proceder√° a las validaciones restantes, de lo contrario, el sistema cancelar√° el proceso.
    2. Si el pedido no tiene apartados o no tiene fecha de √∫ltima asignaci√≥n, entonces no es v√°lido para establecer pr√≥rroga y no se mostrar√° la ventana de pr√≥rroga.
    3. Si el pedido no tiene vigencia, entonces no es v√°lido para establecer d√≠as adicionales.
    4. No se puede modificar los d√≠as de asignaci√≥n a los pedidos con estado de Facturado Total.

S√≠ el pedido seleccionado por el usuario no pertenece a ninguno de los casos anteriores, entonces es v√°lido para carga la ventana y proseguir con la asignaci√≥n de d√≠as adicionales. A continuaci√≥n se ver√°s el siguiente formulario de la ventana de pr√≥rroga:

1. **Campos no editables:**
    - Backorders.
    - Fecha de √öltima Asignaci√≥n.
    - N√∫mero de d√≠as para Deasignaci√≥n del pedido.
    - Fecha Actual (tomando en cuenta los d√≠as de asignaciones previas).
    - Conteo de asignaciones previas.
    - Consecutivo de la asignaci√≥n.
2. **Campos editables:**
    - D√≠as Adicionales.
    - Comentario (raz√≥n / motivo limitado a 101 caracteres).

La ventana del bot√≥n de pr√≥rroga tiene 2 botones en la parte inferior-derecha:

1. **Guardar:** Realiza la validaci√≥n final de la cantidad de d√≠as adicionales (30 con m√°ximo), y si cumple con esa validaci√≥n, se crear√° el nuevo registro de asignaci√≥n.
2. **Cancelar:** Cierra la ventana y cancela el proceso de pr√≥rroga.

## üîê Seguridad

| Tipo UI | Elemento          | Descripci√≥n                    | Rol permitido |
|---------|-------------------|--------------------------------|----------------|
| bot√≥n   | Mostrar m√≥dulo    | Carga la venta de pr√≥rroga en caso de que el usuario y el pedido cumplan las condiciones comentadas en [`Descripci√≥n`](#üìù-descripci√≥n). | Gerente |

## üíº Pol√≠ticas Generales

1. En cuanto a la activaci√≥n del bot√≥n de pr√≥rroga, se mostrar√° mensajes al usuario de porqu√© el pedido no es calificado para asignar m√°s d√≠as de pr√≥rroga.
2. Hay un l√≠mite de 30 d√≠as que se le puedes asignar a un pedido, en caso de necesitar m√°s el sistema sugerir√° que se generen extensiones (creaci√≥n de m√°s registros de asignaci√≥n en esta ventana).
3. El Gerente que entre y cargue la pantalla de pedidos deber√° de tener configurado en su usuario `Gerente Zona` o `Gerente Regional` para crear registros de asignaciones de pr√≥rroga sin l√≠mites, de lo contrario el genrente s√≥lo tendr√° 3 oportunidades de crearlos.

V√©ase [Seguridad](#üîê-seguridad).

## üß™ Casos de Prueba

### 1. Visualizaci√≥n del bot√≥n de pr√≥rroga

#### üíº Operaci√≥n

- [ ] 1. Entra al sistema con un usuario que tenga asignado cualquier rol menos `Gerente`.
- [ ] 2. Haz clic en `Ventas/Pedidos`. Si tiene permiso de cargar la ventana de pedidos, verifica en la parte superior derecha, que es la zona de acciones de pedidos, que no veas el bot√≥n nombrado 'Aumentar d√≠as para Desasignaci√≥n del Pedido' (dejando el cursor un momento encima de los botones para ver el nombre de la acci√≥n).
- [ ] 3. Salir del sistema dando clic en el bot√≥n `Salir` de la parte inferior-izquerda.
- [ ] 4. Entra al sistema con un usuario que tenga asignado el rol `Gerente`.
- [ ] 5. Haz clic en `Ventas/Pedidos`. Si tiene permiso de cargar la ventana de pedidos, verifica en la parte superior derecha, que es la zona de acciones de pedidos, que veas el bot√≥n nombrado 'Aumentar d√≠as para Desasignaci√≥n del Pedido'.

#### üõ°Ô∏è Validaciones

- [ ] Boton de Pr√≥rroga visible si se entra con usuario con rol `Gerente`.
- [ ] Boton de Pr√≥rroga no visible si se entra con usuario con cualquier rol que no sea `Gerente`.

### 2. Carga bloqueda de la ventana del bot√≥n de pr√≥rroga

#### üíº Operaci√≥n

- [ ] 1. Entrar con un usuario con el rol de `Gerente` sin tener configurados `Gerente Zona` y `Gerente Regional`
- [ ] 2. Navega a `Ventas / Pedidos` y filtra los siguientes pedidos para que el sistema valide y te d√© el mensaje correspondiente de bloqueo de carga de la ventana de pr√≥rroga:

    1. Pedido que si es usuario no es `Gerente Zona` o `Gerente Regional` no se cargar√° la ventana debido al n√∫mero de asignaciones previas es mayor a 3:
        - FOLIO: A - 445602.
        - MENSAJE: "Has sobrepasado la cantidad de veces que se puede aumentar los d√≠as de desasignaci√≥n por parte de un Gerente.'Es necesario que a partir de ahora autorice este Pedido alg√∫n Gerente Regional.".
    2. Pedidos sin Apartados o Fecha de √öltima Asignaci√≥n:
        - FOLIOS: TLF - 512322, ZF - 345207.
        - MENSAJE: Aparece un mensaje de confirmaci√≥n, si aceptas el pedido ser√° evaluado a la siguientes validaciones, de lo contrario se cancelar√° el proceso.
    3. Pedidos sin vigencia:
        - FOLIOS: D07 - 379978, D07 - 379999.
        - MENSAJE: "No se puede modificar en Pedidos cancelados.".
    4. Pedidos con estado de Facturado Total:
        - FOLIO: P16 - 56780.
        - MENSAJE: "No se puede modificar en Pedidos Facturados Totales.".

#### üõ°Ô∏è Validaciones

- [ ] Sistema lanza los mensajes especificados con los pedidos mencionados.

### 3. Carga de la ventana bot√≥n de pr√≥rroga

#### üíº Operaci√≥n

- [ ] 1. Busca los pedidos siguientes que pasan las validaciones, se cargar√° la ventana con los siguientes datos del pedido seleccionado (FOLIOS: A - 445602, A - 445585):

    1. **Campos no editables:**
        - Backorders.
        - Fecha de √öltima Asignaci√≥n.
        - N√∫mero de d√≠as para Deasignaci√≥n del pedido.
        - Fecha Actual (tomando en cuenta los d√≠as de asignaciones previas).
        - Conteo de asignaciones previas.
        - Consecutivo de la asignaci√≥n (el nuevo que se le asignsar√° en caso de confirmar el registro).
    2. **Campos editables:**
        - D√≠as Adicionales.
        - Comentario (raz√≥n / motivo limitado a 101 caracteres).

#### üõ°Ô∏è Validaciones

- [ ] Carga sin errores ni mensajes de validaci√≥n de la ventana del pr√≥rroga.

### 4. Validaciones del formulario de pr√≥rroga

#### üíº Operaci√≥n

- [ ] 1. Busca los pedidos siguientes que pasan las validaciones, se cargar√° la ventana con los siguientes datos del pedido seleccionado (FOLIOS: A - 445602, A - 445585).
- [ ] 2. Realiza la siguientes acciones de interacci√≥n con el formulario:

    1. Da clic en el campo de `D√≠as adicionales`, deja vac√≠o el campo y despu√©s da clic en cualquier √°rea de la ventana afuera del campo, aparecer√° el mensaje _"Indique d√≠as adicionales."_.
    2. Cuando ingreses cero (0) en el campo de `D√≠as adicionales`, te mostrar√° debajo del campo el mensaje _"Debe ser mayor a 0."_.
    3. Da clic en el campo de `Comentario`, dejando vac√≠o el campo y despu√©s da clic en cualquier √°rea de la ventana afuera del campo, aparecer√° el mensaje debajo del campo _"Escriba la raz√≥n de asignaci√≥n."_.
    4. Ingresa un valor negativo en el campo de `D√≠as adicionales`, te aparecer√° el mensaje _"Debe ser mayor a 0."_.
    5. Ingresa un valor cualquiera que no sea un n√∫mero entero en el campo de `D√≠as adicionales`, te aparecer√° el mensaje _"Solo se permiten n√∫meros enteros"_.
    6. Ingresa un mensaje en el campo `Comentario`, ver√°s que el contandor de caracteres se actualiza, y se detendr√° de ingresar caracteres cuando el m√°ximo sea alcanzado (101), incluso si es un mensaje es copiado en el portapapeles (_"S√≥lo se permiten 101 caracteres."_).

- [ ] 3. En todo momento las interacciones listadas anteriormente _no debe de habilitar el bot√≥n Guardar_.

#### üõ°Ô∏è Validaciones

- [ ] Todos los casos de interacci√≥n con el formulario se muestran como en la descripci√≥n de los puntos.

### Crear registro de Asignaci√≥n

#### üíº Operaci√≥n

- [ ] 1. Entra al sistema con un usuario que tenga el rol `Gerente` y tenga configurado como `Gerente Regional` o `Gerente Zona`.
- [ ] 2. Navega a `Ventas / Pedidos` y busca / filtra por alg√∫n pedido para abrir la ventana de pr√≥rroga (como el FOLIO `A - 445602`) dando clic a bot√≥n `Aumentar d√≠as para Desasignaci√≥n del Pedido`.
- [ ] 3. Llena los datos de `D√≠as adicionales` con un valor mayor a 30 y un `Comentario`.
- [ ] 4. Se deber√° de habilitar el bot√≥n `Guardar`, da clic en √©l y te dar√° el mensaje de m√°ximo de d√≠as adicionales: _"El m√°ximo de tiempo adicional por ocasi√≥n es de 30 D√≠as. En caso de ser necesario, aplique varias extensiones."_.
- [ ] 5. Corrije el dato de `D√≠as adicionales` (por ejemplo, 10), y cuando des clic en el bot√≥n `Guardar` se mostrar√° un mensaje de confirmaci√≥n, si seleccionas `No` se cancelar el proceso y todav√≠a te mostrar√° la ventana, de lo contrario si seleccionas `S√≠` crear√° la asignaci√≥n de pr√≥rroga y te enviar√° un mensaje de √©xito y se cerrar√° la ventana de pr√≥rroga.
- [ ] 6. Vuelve a abrir la ventana de pr√≥rroga y va a aparecer en los camops no editables los `D√≠as Actuales` incrementando por la cantidad de `D√≠as Adicionales` que ingresaste en la captura anterior, la `Fecha Actual` aumentados por los d√≠as mencionados y `Aumentado (veces)` incrementado en +1 respecto a la primera carga de la ventana de pr√≥rroga.

#### üõ°Ô∏è Validaciones

- [ ] Mensaje de validaci√≥n de m√°ximo de d√≠as adicionales.
- [ ] Creaci√≥n de registro de asignaci√≥n de pr√≥rroga exitosamente.
- [ ] Validaci√≥n de registro de pr√≥rroga volviendo a abrir la ventana de pr√≥rroga.

## üìé Observaciones adicionales

1. Se cambio el evento de `RowClicked` por `SelectionChanged` del grid de pedidos para asignar la referencia del pedido seleccionado.
2. Los eventos `FirstDataRendered` y `FilterChanged` del grid de pedidos ahora se encarga de borrar toda selecci√≥n que se haya hecho de filas completas, y si intentas abrir la ventana de pr√≥rroga sin hacer clic a una fila para seleccionar un pedido se te mostrar√° un mensaje de advertencia: _"Favor de seleccionar un pedido ..."_.

> üóìÔ∏è **Fecha de √∫ltima modificaci√≥n:** 2025-09-26
> üë§ **Sergio Tostado**
> üè∑Ô∏è **Versi√≥n:** 1

---

## Comunicaciones

|Dir|Fecha       |Firma|Comentario                    |
|---|------------|-----|------------------------------|
